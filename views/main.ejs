<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="X-FRAME-OPTIONS" content="DENY">


		<link href="/library/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<script src="/library/jquery/jquery-2.1.0.min.js"></script>
		<script src="/library/jquery-ui/jquery-ui.min.js"></script>
		<script src="/library/jquery-ui/jquery-ui-context.min.js"></script>
	</head>
	<body>
		<div class="row">
			<div class="col-lg-2 directory-list">
				<h3><span class="label label-info">This is for directory</span></h3>
				<ul class='list-group' id="dir_only_list">
                <% 
                  pageDir.forEach(function(file){ 
                %>
                  <li class='list-group-item droppable_forder dir_only_elem' style='color:gray;background-color:whitesmoke'>
                    <div class='row'>
                      <div class='col-sm-12'>
                      	<div>
                          <span class='glyphicon glyphicon-folder-close'> </span>
                          <a class='dir_only dir_share' data-path="<%= file.path %>">
                            <%= file.name %>
                          </a>
                    	</div>
                      </div>
                    </div>
                  </li>
                <%    
                  });
                %>
              </ul> 

			</div>

			<div class="col-lg-4 directory-list">
				<h3><span class="label label-info">This is for list in directory</span></h3>
				<ul class='list-group' id='dir_with_file_list'>

                	<% 
                      pageDir.forEach(function(file){ 
                    %>	
	                    <li class='list-group-item droppable_forder dir_with_file_elem' style='color:gray;background-color:whitesmoke'>
		                    <div class='row'>
		                      <div class='col-sm-12'>
		                        <div >
		                          <span class='glyphicon glyphicon-folder-close'> </span>
		                           <a class='dir_with_file dir_share' data-path="<%= file.path %>">
		                            <%= file.name %>
		                          </a>
		                        </div>
		                      </div>
		                    </div>
	                   </li>

                    <%    
                      });
                      pageEntry.forEach(function(file){ 
                    %>

	                    <li class='list-group-item draggable_file dir_with_file_elem' style='color:gray;background-color:whitesmoke'>
		                    <div class='row'>
		                      <div class='col-sm-4'>
		                          <span class='glyphicon glyphicon-file'> </span>
		                          <a class='file_a_tag_title' href="<%= file.url %>" data-path="<%= file.path %>">
		                            <%= file.title %>
		                          </a>
		                      </div>
		                      <div class ="col-sm-8">
		                      	<a class='file_a_tag' href="<%= file.url %>" data-path="<%= file.path %>">
		                            <%= file.content %>
		                        </a>
		                      </div>
		                    </div>
	                   </li>

                    <%    
                      });
                    %>
                  
              </ul> 
			</div>


			<div class="col-lg-6">
				<h3><span class="label label-info">This is View</span></h3>
				<a href="http://www.w3schools.com" target="_blank">Visit W3Schools.com!</a> 
			</div>

		</div>
		<style type="text/css">
			.directory-list{
				border-right: 3px solid #cccccc;
				height: 100%;

			}

		</style>
		<script type="text/javascript">
			$('.directory-list').contextmenu({
				delegate: ".droppable_forder",
				menu: [
				    {title: "Delete", cmd: "delete", uiIcon: "ui-icon-delete"}
				    ],
				select: function(event, ui) {
				    alert("select " + ui.cmd + " on " + ui.target.text());
				}
			})
			var init=function(){
					click_event_dir_only();
					click_event_dir_with_file();
					droppable_event();
					draggable_event();


			}
			var click_event_dir_only=function(){$('.dir_only').on('click',function(event){
				var jquery_obj= $(this);
				var params={
					userKey:"TempUserKey",
					path:jquery_obj.data('path')+jquery_obj.text().trim()
				}
				$.ajax({
					type:"POST",
					url:"/ajax/get_pageDir_list", //only dir
					data:params,
					dataType:"JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨
					success : function(data) {
						//data is list
						if(data.status==0){
							alert('last folder');
							return;
						}
						var data=data.data;
						$('.dir_only_elem').remove();
						var result=data.pageDir;
						var innerhtml_str=""
						result.forEach(function(indata){
							innerhtml_str+="<li class='list-group-item droppable_forder dir_only_elem' style='color:gray;background-color:whitesmoke'>"+
			                    "<div class='row'>"+
			                      "<div class='col-sm-12'>"+
			                      	"<div>"+
			                          "<span class='glyphicon glyphicon-folder-close'> </span>"+
			                          "<a class='dir_only dir_share' data-path='&&dirpath&&'>"+
			                            "&&dirname&&"+
			                          "</a>"+
			                    	"</div>"+
			                      "</div>"+
			                    "</div>"+
			                "</li>";
			                innerhtml_str=innerhtml_str.replace('&&dirname&&',indata.name).replace('&&dirpath&&',indata.path)
						})

						document.getElementById("dir_only_list").innerHTML=innerhtml_str;
						init();
					},
					error : function(xhr, status, error) {
						alert("Error");
					}
				})

			})
			}
			var click_event_dir_with_file=function(){$('.dir_with_file').on('click',function(){
				var jquery_obj= $(this);
				var params={
					userKey:"TempUserKey",
					path:jquery_obj.data('path')+jquery_obj.text().trim()
				}
				console.log(params)
				$.ajax({
					type:"POST",
					url:"/ajax/get_pageAll_list", //dir with file
					data:params,
					dataType:"JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨
					success : function(data) {
						//data is list file and dir
						if(data.status==0){
							alert('last folder');
							return;
						}
						var data=data.data;

						$('.dir_with_file_elem').remove();
						var resultDir=data.pageDir;
						var resultEntry=data.pageEntry;
						var innerhtml_str="";
						console.log(resultDir)
						resultDir.forEach(function(indata){
							innerhtml_str+="<li class='list-group-item droppable_forder dir_with_file_elem' style='color:gray;background-color:whitesmoke'>"+
			                    "<div class='row'>"+
			                      "<div class='col-sm-12'>"+
			                      	"<div>"+
			                          "<span class='glyphicon glyphicon-folder-close'> </span>"+
			                          "<a class='dir_with_file dir_share' data-path='&&dirpath&&'>"+
			                            "&&dirname&&"+
			                          "</a>"+
			                    	"</div>"+
			                      "</div>"+
			                    "</div>"+
			                "</li>";
			                innerhtml_str=innerhtml_str.replace(/&&dirname&&/g,indata.name).replace(/&&dirpath&&/g,indata.path)
						})
						resultEntry.forEach(function(indata){
							innerhtml_str+="<li class='list-group-item droppable_forder dir_with_file_elem' style='color:gray;background-color:whitesmoke'>"+
			                    "<div class='row'>"+
			                      "<div class='col-sm-4'>"+
			                          "<span class='glyphicon glyphicon-file'> </span>"+
			                          "<a class='file_a_tag_title' href='&&entryurl&&' data-path='&&entrypath&&'>"+
			                            "&&title&&"+
			                          "</a>"+
			                      "</div>"+
			                      "<div class='col-sm-8'>"+
			                          "<a class='file_a_tag' href='&&entryurl&&' data-path='&&entrypath&&'>"+
			                            "&&content&&"+
			                          "</a>"+
			                      "</div>"+
			                    "</div>"+
			                "</li>";
			                innerhtml_str=innerhtml_str.replace(/&&entryurl&&/g,indata.url).replace(/&&entrypath&&/g,indata.path).replace(/&&title&&/g,indata.title).replace(/&&content&&/g,indata.content)
						})

						document.getElementById("dir_with_file_list").innerHTML=innerhtml_str;
						init();
					},
					error : function(xhr, status, error) {
						alert("Error");
					}
				})

			})
			}
			var draggable_event=function(){$('.draggable_file').draggable( {
				start:function(e,u){
		           console.log("start")
		        },
		        drag:function(e,u){
		           console.log("drag")
		        },
		        stop:function(e,u){
		            console.log("stop")
		        },
		        revert: true,
		        opacity:"0.3"

			});
			}
			var droppable_event=function(){$('.droppable_forder').droppable({


				drop: function(event, ui) {
					var jquery_obj= $(this).find(".dir_share");
				
					var dragobj=$(ui.draggable);
					var params={
						userKey:"TempUserKey",
						pageInfo:{
							oldPath:dragobj.find('.file_a_tag_title').data('path'),
							newPath:jquery_obj.data('path')+jquery_obj.text().trim(),
							title:dragobj.find('.file_a_tag_title').text().trim()
						}
					};
					$.ajax({
						type:"POST",
						url:"/ajax/move_entryPath",
						dataType:"JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨
						data:params,
						success : function(data) {

							dragobj.remove()
							init();
						},
						error : function(xhr, status, error) {
							alert("Error");
						}
					})
                }

			})
			}
			$(window).load(function(){
				init();
			})

		</script>
	</body>
</html>